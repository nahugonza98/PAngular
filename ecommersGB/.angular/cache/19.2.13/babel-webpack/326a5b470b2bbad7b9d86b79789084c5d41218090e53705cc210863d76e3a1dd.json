{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HttpClientModule } from '@angular/common/http';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nfunction FacturaPreviewComponent_tr_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵpipe(13, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"td\");\n    i0.ɵɵtext(15);\n    i0.ɵɵpipe(16, \"number\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const p_r1 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(p_r1.nombre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"$ \", i0.ɵɵpipeBind2(5, 6, p_r1.precio, \"1.2-2\"), \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"U$D \", i0.ɵɵpipeBind2(8, 9, p_r1.precio / ctx_r1.cotizacionUSD, \"1.2-2\"), \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(p_r1.cantidad);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"$ \", i0.ɵɵpipeBind2(13, 12, ctx_r1.obtenerSubtotal(p_r1), \"1.2-2\"), \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"U$D \", i0.ɵɵpipeBind2(16, 15, ctx_r1.obtenerSubtotalUSD(p_r1), \"1.2-2\"), \"\");\n  }\n}\nfunction FacturaPreviewComponent_div_30_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 4)(1, \"p\");\n    i0.ɵɵtext(2, \" \\uD83D\\uDCB1 Cotizaci\\u00F3n oficial del BCRA: \");\n    i0.ɵɵelementStart(3, \"strong\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(6, \" ARS/USD\");\n    i0.ɵɵelement(7, \"br\");\n    i0.ɵɵtext(8, \" \\u00BFQuer\\u00E9s pagar en d\\u00F3lares? \");\n    i0.ɵɵelement(9, \"br\");\n    i0.ɵɵelementStart(10, \"a\", 5);\n    i0.ɵɵtext(11, \"\\uD83D\\uDCF2 Contactanos por WhatsApp\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"button\", 6);\n    i0.ɵɵlistener(\"click\", function FacturaPreviewComponent_div_30_Template_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.confirmar());\n    });\n    i0.ɵɵtext(13, \"\\u2705 Confirmar compra\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"$ \", i0.ɵɵpipeBind2(5, 1, ctx_r1.cotizacionUSD, \"1.2-2\"), \"\");\n  }\n}\nexport let FacturaPreviewComponent = /*#__PURE__*/(() => {\n  class FacturaPreviewComponent {\n    http;\n    confirmarCompra = new EventEmitter();\n    productos = [];\n    cotizacionUSD = 0;\n    constructor(http) {\n      this.http = http;\n    }\n    ngOnInit() {\n      this.http.get('https://dolarapi.com/v1/dolares/oficial').subscribe({\n        next: res => {\n          console.log('📊 Cotización oficial:', res);\n          this.cotizacionUSD = Number(res.venta) || 0;\n        },\n        error: err => {\n          console.error('❌ Error al obtener cotización DolarApi:', err);\n          this.cotizacionUSD = 0;\n        }\n      });\n    }\n    round2(n) {\n      return Math.round((n + Number.EPSILON) * 100) / 100;\n    }\n    obtenerSubtotal(p) {\n      return p.precio * p.cantidad;\n    }\n    obtenerSubtotalUSD(p) {\n      return this.cotizacionUSD ? this.obtenerSubtotal(p) / this.cotizacionUSD : 0;\n    }\n    obtenerTotal() {\n      return this.productos.reduce((acc, p) => acc + this.obtenerSubtotal(p), 0);\n    }\n    obtenerTotalUSD() {\n      return this.cotizacionUSD ? this.obtenerTotal() / this.cotizacionUSD : 0;\n    }\n    confirmar() {\n      const fx = this.cotizacionUSD || 0;\n      const items = this.productos.map(p => {\n        const subtotalArs = this.obtenerSubtotal(p);\n        const precioUsd = fx ? p.precio / fx : 0;\n        const subtotalUsd = fx ? subtotalArs / fx : 0;\n        return {\n          producto_id: typeof p.id === 'number' ? p.id : null,\n          producto_nombre: p.nombre,\n          cantidad: p.cantidad,\n          precio_unit_ars: this.round2(p.precio),\n          subtotal_ars: this.round2(subtotalArs),\n          precio_unit_usd: this.round2(precioUsd),\n          subtotal_usd: this.round2(subtotalUsd)\n        };\n      });\n      const payload = {\n        fecha: new Date().toISOString(),\n        cliente_id: null,\n        cliente_nombre: null,\n        tipo_cambio: fx,\n        total_ars: this.round2(this.obtenerTotal()),\n        total_usd: this.round2(this.obtenerTotalUSD()),\n        items\n      };\n      console.log('[FacturaPreview] Payload listo para confirmar:', payload);\n      this.confirmarCompra.emit(payload);\n    }\n    static ɵfac = function FacturaPreviewComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || FacturaPreviewComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: FacturaPreviewComponent,\n      selectors: [[\"app-factura-preview\"]],\n      inputs: {\n        productos: \"productos\"\n      },\n      outputs: {\n        confirmarCompra: \"confirmarCompra\"\n      },\n      decls: 31,\n      vars: 10,\n      consts: [[1, \"tabla\"], [4, \"ngFor\", \"ngForOf\"], [1, \"total\"], [\"class\", \"compra-usd\", 4, \"ngIf\"], [1, \"compra-usd\"], [\"href\", \"https://wa.me/5491123456789\", \"target\", \"_blank\"], [1, \"btn\", \"btn-success\", 3, \"click\"]],\n      template: function FacturaPreviewComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"h3\");\n          i0.ɵɵtext(1, \"\\uD83E\\uDDFE Detalle de la factura\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(2, \"table\", 0)(3, \"thead\")(4, \"tr\")(5, \"th\");\n          i0.ɵɵtext(6, \"Producto\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"th\");\n          i0.ɵɵtext(8, \"Precio ARS\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(9, \"th\");\n          i0.ɵɵtext(10, \"Precio USD\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(11, \"th\");\n          i0.ɵɵtext(12, \"Cantidad\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(13, \"th\");\n          i0.ɵɵtext(14, \"Subtotal ARS\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(15, \"th\");\n          i0.ɵɵtext(16, \"Subtotal USD\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(17, \"tbody\");\n          i0.ɵɵtemplate(18, FacturaPreviewComponent_tr_18_Template, 17, 18, \"tr\", 1);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(19, \"div\", 2)(20, \"p\")(21, \"strong\");\n          i0.ɵɵtext(22, \"Total ARS:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(23);\n          i0.ɵɵpipe(24, \"number\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(25, \"p\")(26, \"strong\");\n          i0.ɵɵtext(27, \"Total USD:\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(28);\n          i0.ɵɵpipe(29, \"number\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(30, FacturaPreviewComponent_div_30_Template, 14, 4, \"div\", 3);\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(18);\n          i0.ɵɵproperty(\"ngForOf\", ctx.productos);\n          i0.ɵɵadvance(5);\n          i0.ɵɵtextInterpolate1(\" $ \", i0.ɵɵpipeBind2(24, 4, ctx.obtenerTotal(), \"1.2-2\"), \"\");\n          i0.ɵɵadvance(5);\n          i0.ɵɵtextInterpolate1(\" U$D \", i0.ɵɵpipeBind2(29, 7, ctx.obtenerTotalUSD(), \"1.2-2\"), \"\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ctx.cotizacionUSD);\n        }\n      },\n      dependencies: [CommonModule, i2.NgForOf, i2.NgIf, i2.DecimalPipe, HttpClientModule],\n      styles: [\".tabla[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:1rem}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ccc;padding:8px;text-align:center}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f0f0f0}.total[_ngcontent-%COMP%]{margin-top:1rem;font-size:1.2rem}.compra-usd[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background-color:#f0f8ff;border:1px solid #ccc;border-radius:6px}.compra-usd[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#007bff;text-decoration:none}.btn-confirmar[_ngcontent-%COMP%]{margin-top:1rem;padding:.5rem 1rem;background-color:green;color:#fff;border:none;border-radius:5px;cursor:pointer}h3[_ngcontent-%COMP%]{margin-bottom:20px;font-size:1.4rem;color:#333}.tabla[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:20px}.tabla[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#f0f0f0}.tabla[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabla[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 8px;text-align:center;border:1px solid #ccc}.total[_ngcontent-%COMP%]{margin-top:15px;font-size:1.1rem;font-weight:700}.compra-usd[_ngcontent-%COMP%]{margin-top:20px;background-color:#eef8ff;padding:15px;border:1px solid #a8d1ff;border-radius:8px;font-size:.95rem;color:#333}.compra-usd[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#07c;font-weight:700;text-decoration:none}.compra-usd[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}button.btn-success[_ngcontent-%COMP%]{margin-top:15px;padding:10px 16px;font-size:1rem;border:none;border-radius:6px;background-color:#28a745;color:#fff;cursor:pointer}button.btn-success[_ngcontent-%COMP%]:hover{background-color:#218838}\"]\n    });\n  }\n  return FacturaPreviewComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}