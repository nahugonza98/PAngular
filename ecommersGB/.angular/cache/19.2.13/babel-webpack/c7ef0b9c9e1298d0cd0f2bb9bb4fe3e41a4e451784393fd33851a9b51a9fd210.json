{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Nahuel/Documents/Proyectos/PAngular-master/PAngular-master/ecommersGB/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport { FormsModule } from '@angular/forms';\nimport { FiltroNombrePipe } from '../../pages/pipes/filtro-nombre.pipe';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../servicios/productos.service\";\nimport * as i2 from \"../../servicios/carrito.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/forms\";\nconst _c0 = a0 => [\"/editar-producto\", a0];\nfunction ProductosComponent_div_5_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"a\", 15);\n    i0.ɵɵtext(2, \"\\u270F\\uFE0F Editar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function ProductosComponent_div_5_div_2_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const producto_r3 = i0.ɵɵnextContext().$implicit;\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.confirmarEliminar(producto_r3.id));\n    });\n    i0.ɵɵtext(4, \"\\uD83D\\uDDD1\\uFE0F Eliminar\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const producto_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(1, _c0, producto_r3.id));\n  }\n}\nfunction ProductosComponent_div_5_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 17);\n    i0.ɵɵtext(1, \" \\u00A1\\u00DAltimas unidades! \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductosComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵelement(1, \"img\", 8);\n    i0.ɵɵtemplate(2, ProductosComponent_div_5_div_2_Template, 5, 3, \"div\", 9);\n    i0.ɵɵelementStart(3, \"div\", 10)(4, \"h3\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 11);\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, ProductosComponent_div_5_div_9_Template, 2, 0, \"div\", 12);\n    i0.ɵɵelementStart(10, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function ProductosComponent_div_5_Template_button_click_10_listener() {\n      const producto_r3 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.agregarAlCarrito(producto_r3));\n    });\n    i0.ɵɵtext(11, \" A\\u00F1adir al carrito \");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const producto_r3 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"src\", producto_r3.imagen, i0.ɵɵsanitizeUrl)(\"alt\", producto_r3.nombre);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", (ctx_r3.usuarioActual == null ? null : ctx_r3.usuarioActual.rol) === \"admin\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(producto_r3.nombre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"$ \", i0.ɵɵpipeBind2(8, 6, producto_r3.precio, \"1.0-2\"), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", producto_r3.stock < 3);\n  }\n}\nfunction ProductosComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18);\n    i0.ɵɵtext(1, \" \\u2705 \");\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4, \" fue agregado al carrito\\n\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r3.productoAgregado);\n  }\n}\nfunction ProductosComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 19)(1, \"div\", 20)(2, \"h3\");\n    i0.ɵɵtext(3, \"\\u00BFEliminar producto?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5, \"\\u00BFEst\\u00E1s seguro de que quer\\u00E9s eliminar este producto?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 21)(7, \"button\", 22);\n    i0.ɵɵlistener(\"click\", function ProductosComponent_div_8_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.eliminarConfirmado());\n    });\n    i0.ɵɵtext(8, \"S\\u00ED, eliminar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function ProductosComponent_div_8_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.cancelarEliminar());\n    });\n    i0.ɵɵtext(10, \"Cancelar\");\n    i0.ɵɵelementEnd()()()();\n  }\n}\nexport let ProductosComponent = /*#__PURE__*/(() => {\n  class ProductosComponent {\n    constructor(productosService, carritoService) {\n      this.productosService = productosService;\n      this.carritoService = carritoService;\n      this.productos = [];\n      this.filtro = '';\n      this.mostrarConfirmacion = false;\n      this.productoAgregado = '';\n      this.idProductoAEliminar = null;\n      this.mostrarModalEliminar = false;\n      this.usuarioActual = null;\n    }\n    ngOnInit() {\n      // Cargar productos desde Firebase RTDB\n      this.productosService.obtenerProductos().subscribe(data => {\n        // fallback de stock en 0 si viene null\n        this.productos = data.map(p => ({\n          ...p,\n          stock: p.stock ?? 0\n        }));\n      });\n      // Cargar usuario actual desde localStorage\n      if (typeof window !== 'undefined') {\n        const usuario = localStorage.getItem('usuarioActual');\n        this.usuarioActual = usuario ? JSON.parse(usuario) : null;\n      }\n    }\n    agregarAlCarrito(producto) {\n      this.carritoService.agregarProducto(producto);\n      this.productoAgregado = producto.nombre;\n      this.mostrarConfirmacion = true;\n      setTimeout(() => {\n        this.mostrarConfirmacion = false;\n      }, 2500);\n    }\n    confirmarEliminar(id) {\n      this.idProductoAEliminar = id;\n      this.mostrarModalEliminar = true;\n    }\n    cancelarEliminar() {\n      this.idProductoAEliminar = null;\n      this.mostrarModalEliminar = false;\n    }\n    eliminarConfirmado() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (_this.idProductoAEliminar !== null) {\n          try {\n            yield _this.productosService.eliminarProducto(_this.idProductoAEliminar);\n            _this.productos = _this.productos.filter(p => p.id !== _this.idProductoAEliminar);\n            _this.mostrarModalEliminar = false;\n          } catch (e) {\n            console.error('Error eliminando producto en RTDB', e);\n            alert('No se pudo eliminar el producto.');\n          }\n        }\n      })();\n    }\n    static {\n      this.ɵfac = function ProductosComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ProductosComponent)(i0.ɵɵdirectiveInject(i1.ProductosService), i0.ɵɵdirectiveInject(i2.CarritoService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ProductosComponent,\n        selectors: [[\"app-productos\"]],\n        decls: 9,\n        vars: 7,\n        consts: [[1, \"titulo\"], [1, \"buscador\"], [\"type\", \"text\", \"placeholder\", \"\\uD83D\\uDD0D Buscar producto...\", 1, \"form-control\", 3, \"ngModelChange\", \"ngModel\"], [1, \"grid-productos\"], [\"class\", \"tarjeta\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"modal-confirmacion\", 4, \"ngIf\"], [\"class\", \"modal-overlay\", 4, \"ngIf\"], [1, \"tarjeta\"], [1, \"imagen-producto\", 3, \"src\", \"alt\"], [\"class\", \"botones-abm\", 4, \"ngIf\"], [1, \"contenido-tarjeta\"], [1, \"precio\"], [\"class\", \"ultimas-unidades\", 4, \"ngIf\"], [1, \"btn-agregar\", 3, \"click\"], [1, \"botones-abm\"], [1, \"btn-editar\", 3, \"routerLink\"], [1, \"btn-eliminar\", 3, \"click\"], [1, \"ultimas-unidades\"], [1, \"modal-confirmacion\"], [1, \"modal-overlay\"], [1, \"modal-contenido\"], [1, \"modal-botones\"], [1, \"btn-confirmar\", 3, \"click\"], [1, \"btn-cancelar\", 3, \"click\"]],\n        template: function ProductosComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"h2\", 0);\n            i0.ɵɵtext(1, \"Productos disponibles\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(2, \"div\", 1)(3, \"input\", 2);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function ProductosComponent_Template_input_ngModelChange_3_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.filtro, $event) || (ctx.filtro = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(4, \"div\", 3);\n            i0.ɵɵtemplate(5, ProductosComponent_div_5_Template, 12, 9, \"div\", 4);\n            i0.ɵɵpipe(6, \"filtroNombre\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(7, ProductosComponent_div_7_Template, 5, 1, \"div\", 5)(8, ProductosComponent_div_8_Template, 11, 0, \"div\", 6);\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.filtro);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind2(6, 4, ctx.productos, ctx.filtro));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.mostrarConfirmacion);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.mostrarModalEliminar);\n          }\n        },\n        dependencies: [CommonModule, i3.NgForOf, i3.NgIf, i3.DecimalPipe, RouterModule, i4.RouterLink, FormsModule, i5.DefaultValueAccessor, i5.NgControlStatus, i5.NgModel, FiltroNombrePipe],\n        styles: [\".titulo[_ngcontent-%COMP%]{text-align:center;margin:2.2rem 0 1.2rem;font-size:2rem;font-weight:800}.buscador[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin:0 32px 18px 0}.buscador[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:10px 12px;border:2px solid #0ea5e9;border-radius:10px;font-size:1rem;width:280px;box-shadow:0 2px 8px #0284c71f;transition:border-color .2s ease,box-shadow .2s ease}.buscador[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#0369a1;outline:none;box-shadow:0 0 0 4px #0ea5e926}.grid-productos[_ngcontent-%COMP%]{--card-min: 240px;display:grid;grid-template-columns:repeat(auto-fit,minmax(var(--card-min),1fr));gap:22px;padding:0 24px 48px}.tarjeta[_ngcontent-%COMP%]{background:#fff;border-radius:14px;overflow:hidden;border:1px solid #eaeaea;box-shadow:0 10px 24px #0000000f;transition:transform .15s ease,box-shadow .15s ease,border-color .15s ease}.tarjeta[_ngcontent-%COMP%]:hover{transform:translateY(-3px);border-color:#dbeafe;box-shadow:0 16px 36px #1e40af1f}.imagen-producto[_ngcontent-%COMP%], .tarjeta[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;width:100%;height:180px;object-fit:cover;background:#f8fafc}.contenido-tarjeta[_ngcontent-%COMP%]{padding:14px 14px 16px;text-align:center}.contenido-tarjeta[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.05rem;margin:4px 0 6px;font-weight:700}.precio[_ngcontent-%COMP%]{font-weight:800;font-size:1.05rem;margin:2px 0 8px}.ultimas-unidades[_ngcontent-%COMP%]{display:inline-block;background:#fef2f2;color:#b91c1c;font-weight:700;font-size:.85rem;padding:4px 8px;border-radius:999px;margin-bottom:10px}.btn-agregar[_ngcontent-%COMP%]{display:inline-block;margin-top:6px;background:linear-gradient(180deg,#2563eb,#1d4ed8);color:#fff;border:none;padding:10px 14px;cursor:pointer;border-radius:10px;font-weight:700;letter-spacing:.2px;transition:transform .1s ease,filter .2s ease,box-shadow .2s ease;box-shadow:0 8px 18px #2563eb40}.btn-agregar[_ngcontent-%COMP%]:hover{filter:brightness(1.05);box-shadow:0 10px 22px #1d4ed859}.btn-agregar[_ngcontent-%COMP%]:active{transform:scale(.96)}.botones-abm[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:center;padding:10px;background:#f8fafc;border-bottom:1px solid #eef2ff}.btn-editar[_ngcontent-%COMP%], .btn-eliminar[_ngcontent-%COMP%]{padding:6px 10px;border-radius:8px;font-weight:700;border:none;cursor:pointer;text-decoration:none}.btn-editar[_ngcontent-%COMP%]{background:#fde68a;color:#7c2d12}.btn-eliminar[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.btn-eliminar[_ngcontent-%COMP%]:hover{filter:brightness(1.05)}.modal-confirmacion[_ngcontent-%COMP%]{position:fixed;top:16px;right:16px;background:#dcfce7;color:#065f46;padding:12px 16px;border-radius:12px;font-weight:800;box-shadow:0 12px 28px #10b98140;animation:_ngcontent-%COMP%_fadein .25s ease;z-index:1000}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000073;display:grid;place-items:center;z-index:1000}.modal-contenido[_ngcontent-%COMP%]{width:320px;background:#fff;border-radius:14px;padding:20px;text-align:center;box-shadow:0 24px 48px #0003}.modal-botones[_ngcontent-%COMP%]{margin-top:14px;display:flex;gap:10px;justify-content:center}.btn-confirmar[_ngcontent-%COMP%], .btn-cancelar[_ngcontent-%COMP%]{border:none;padding:8px 12px;border-radius:10px;font-weight:700}.btn-confirmar[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.btn-cancelar[_ngcontent-%COMP%]{background:#9ca3af;color:#fff}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 420px){.buscador[_ngcontent-%COMP%]{justify-content:center;margin:0 0 16px}.buscador[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}.imagen-producto[_ngcontent-%COMP%], .tarjeta[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:160px}}\"]\n      });\n    }\n  }\n  return ProductosComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}