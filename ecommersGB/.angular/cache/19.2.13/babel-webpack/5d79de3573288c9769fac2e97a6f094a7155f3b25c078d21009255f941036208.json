{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport { FiltroFacturaPipe } from '../../pages/pipes/filtro-factura.pipe';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../servicios/factura.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/router\";\nconst _c0 = () => [\"/estadisticas\"];\nfunction FacturasComponent_table_9_tr_14_td_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const factura_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" $ \", i0.ɵɵpipeBind2(2, 1, factura_r2.totalUSD, \"1.2-2\"), \" \");\n  }\n}\nfunction FacturasComponent_table_9_tr_14_ng_template_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵtext(1, \"\\u2014\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction FacturasComponent_table_9_tr_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, FacturasComponent_table_9_tr_14_td_9_Template, 3, 4, \"td\", 11)(10, FacturasComponent_table_9_tr_14_ng_template_10_Template, 2, 0, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementStart(12, \"td\");\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const factura_r2 = ctx.$implicit;\n    const sinUSD_r3 = i0.ɵɵreference(11);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(factura_r2.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 6, factura_r2.fechaISO, \"short\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"$ \", i0.ɵɵpipeBind2(8, 9, factura_r2.totalARS, \"1.2-2\"), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", factura_r2.totalUSD != null)(\"ngIfElse\", sinUSD_r3);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(factura_r2.cliente_nombre || \"\\u2014\");\n  }\n}\nfunction FacturasComponent_table_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 9)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"ID\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Fecha\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Total (ARS)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Total (USD)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\");\n    i0.ɵɵtext(12, \"Cliente\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(13, \"tbody\");\n    i0.ɵɵtemplate(14, FacturasComponent_table_9_tr_14_Template, 14, 12, \"tr\", 10);\n    i0.ɵɵpipe(15, \"filtroFactura\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(14);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind2(15, 1, ctx_r3.facturas, ctx_r3.filtroFactura));\n  }\n}\nfunction FacturasComponent_ng_template_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"No hay facturas registradas.\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let FacturasComponent = /*#__PURE__*/(() => {\n  class FacturasComponent {\n    facturasSrv;\n    filtroFactura = '';\n    facturas = [];\n    sub;\n    descargandoCsv = false;\n    constructor(facturasSrv) {\n      this.facturasSrv = facturasSrv;\n    }\n    ngOnInit() {\n      // Suscripción al observable del servicio\n      this.sub = this.facturasSrv.facturas$().subscribe(data => {\n        // Asignamos directamente a facturas (ya no facturasRaw)\n        this.facturas = data;\n      });\n    }\n    ngOnDestroy() {\n      this.sub?.unsubscribe();\n    }\n    exportarCSV() {\n      if (!this.facturas?.length) return;\n      this.descargandoCsv = true;\n      try {\n        const blob = this.facturasSrv.generarCSVDesdeFacturas(this.facturas);\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `facturas-${new Date().toISOString().slice(0, 10)}.csv`;\n        document.body.appendChild(a);\n        a.click();\n        a.remove();\n        URL.revokeObjectURL(url);\n      } finally {\n        this.descargandoCsv = false;\n      }\n    }\n    static ɵfac = function FacturasComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || FacturasComponent)(i0.ɵɵdirectiveInject(i1.FacturaService));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: FacturasComponent,\n      selectors: [[\"app-facturas\"]],\n      decls: 12,\n      vars: 6,\n      consts: [[\"sinDatos\", \"\"], [\"sinUSD\", \"\"], [1, \"titulo\"], [1, \"toolbar\"], [1, \"buscador\"], [\"type\", \"text\", \"placeholder\", \"\\uD83D\\uDD0D Buscar por ID...\", 1, \"form-control\", 3, \"ngModelChange\", \"ngModel\"], [1, \"btn\", \"btn-outline-success\", \"csv-btn\", 3, \"routerLink\"], [\"type\", \"button\", 1, \"csv-btn\", 3, \"click\", \"disabled\"], [\"class\", \"tabla-facturas\", 4, \"ngIf\", \"ngIfElse\"], [1, \"tabla-facturas\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\", \"ngIfElse\"]],\n      template: function FacturasComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"h2\", 2);\n          i0.ɵɵtext(1, \"Facturas generadas\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(2, \"div\", 3)(3, \"div\", 4)(4, \"input\", 5);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function FacturasComponent_Template_input_ngModelChange_4_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.filtroFactura, $event) || (ctx.filtroFactura = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(5, \"button\", 6);\n          i0.ɵɵtext(6, \"Estad\\u00EDsticas\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"button\", 7);\n          i0.ɵɵlistener(\"click\", function FacturasComponent_Template_button_click_7_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.exportarCSV());\n          });\n          i0.ɵɵtext(8, \" Exportar CSV \");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(9, FacturasComponent_table_9_Template, 16, 4, \"table\", 8)(10, FacturasComponent_ng_template_10_Template, 2, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        }\n        if (rf & 2) {\n          const sinDatos_r5 = i0.ɵɵreference(11);\n          i0.ɵɵadvance(4);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.filtroFactura);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(5, _c0));\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"disabled\", ctx.descargandoCsv);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ctx.facturas.length > 0)(\"ngIfElse\", sinDatos_r5);\n        }\n      },\n      dependencies: [CommonModule, i2.NgForOf, i2.NgIf, i2.DecimalPipe, i2.DatePipe, FormsModule, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgModel, FiltroFacturaPipe, RouterModule, i4.RouterLink],\n      styles: [\".titulo[_ngcontent-%COMP%]{font-size:1.6rem;margin-bottom:1rem}.tabla-facturas[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:1rem}.tabla-facturas[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabla-facturas[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ccc;padding:8px;text-align:center}.tabla-facturas[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f4f4f4}.toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin:12px 0}.toolbar[_ngcontent-%COMP%]   .buscador[_ngcontent-%COMP%]{flex:1}.buscador[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:44px;padding:0 12px;font-size:14px;border:1px solid #ced4da;border-radius:8px;transition:border-color .15s,box-shadow .15s}.buscador[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{outline:0;border-color:#86b7fe;box-shadow:0 0 0 .2rem #0d6efd40}.csv-btn[_ngcontent-%COMP%]{height:44px;min-width:170px;padding:0 16px;border-radius:8px;border:1px solid #0d6efd;background:#0d6efd;color:#fff;font-size:14px;font-weight:600;line-height:1;display:inline-flex;align-items:center;justify-content:center;gap:8px;cursor:pointer;box-shadow:0 1px 2px #0000000f;transition:background .15s,border-color .15s,box-shadow .15s}.csv-btn[_ngcontent-%COMP%]:hover{background:#0b62e5;border-color:#0b62e5}.csv-btn[_ngcontent-%COMP%]:focus-visible{outline:0;box-shadow:0 0 0 .2rem #0d6efd40}.csv-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}\"]\n    });\n  }\n  return FacturasComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}