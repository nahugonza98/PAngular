{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Nahuel/Documents/Proyectos/PAngular-master/PAngular-master/ecommersGB/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { CommonModule } from '@angular/common';\nimport { FacturaPreviewComponent } from '../facturas-preview/factura-preview.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../servicios/carrito.service\";\nimport * as i2 from \"../../servicios/factura.service\";\nimport * as i3 from \"@angular/router\";\nexport let FinalizarCompraComponent = /*#__PURE__*/(() => {\n  class FinalizarCompraComponent {\n    constructor(carritoService, facturaService, router) {\n      this.carritoService = carritoService;\n      this.facturaService = facturaService;\n      this.router = router;\n      this.productosSeleccionados = [];\n      this.guardando = false;\n    }\n    ngOnInit() {\n      this.productosSeleccionados = this.carritoService.obtenerProductos();\n    }\n    // Recibe el objeto emitido por <app-factura-preview (confirmarCompra)=\"confirmarCompra($event)\">\n    confirmarCompra(payload) {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        console.log('[Padre] Recib√≠ payload:', payload);\n        if (!payload || !payload.items?.length) {\n          alert('No hay √≠tems para facturar.');\n          return;\n        }\n        if (!payload.tipo_cambio || payload.tipo_cambio <= 0) {\n          alert('No se pudo obtener la cotizaci√≥n del d√≥lar. Intenta nuevamente.');\n          return;\n        }\n        // üîπ Adaptamos a lo que espera crearFactura():\n        const facturaAdaptada = {\n          totalARS: payload.total_ars,\n          totalUSD: payload.total_usd,\n          tipo_cambio: payload.tipo_cambio,\n          items: payload.items.map(item => ({\n            producto_id: item.producto_id ?? 0,\n            producto_nombre: item.producto_nombre,\n            cantidad: item.cantidad,\n            precio_unitario: item.precio_unit_ars,\n            subtotal_ars: item.subtotal_ars\n          }))\n        };\n        _this.guardando = true;\n        try {\n          // ‚úÖ Usamos el m√©todo nuevo del servicio\n          const res = yield _this.facturaService.crearFactura(facturaAdaptada);\n          console.log('‚úÖ Factura guardada:', res);\n          _this.carritoService.vaciarCarrito();\n          _this.productosSeleccionados = [];\n          setTimeout(() => _this.router.navigate(['/']), 800);\n        } catch (err) {\n          console.error('‚ùå Error guardando factura:', err?.error || err);\n          alert(err?.error?.message || '‚ùå Hubo un error al guardar la factura');\n        } finally {\n          _this.guardando = false;\n        }\n      })();\n    }\n    static {\n      this.…µfac = function FinalizarCompraComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || FinalizarCompraComponent)(i0.…µ…µdirectiveInject(i1.CarritoService), i0.…µ…µdirectiveInject(i2.FacturaService), i0.…µ…µdirectiveInject(i3.Router));\n      };\n    }\n    static {\n      this.…µcmp = /*@__PURE__*/i0.…µ…µdefineComponent({\n        type: FinalizarCompraComponent,\n        selectors: [[\"app-finalizar-compra\"]],\n        decls: 3,\n        vars: 1,\n        consts: [[3, \"confirmarCompra\", \"productos\"]],\n        template: function FinalizarCompraComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.…µ…µelementStart(0, \"h2\");\n            i0.…µ…µtext(1, \"Confirmar compra\");\n            i0.…µ…µelementEnd();\n            i0.…µ…µelementStart(2, \"app-factura-preview\", 0);\n            i0.…µ…µlistener(\"confirmarCompra\", function FinalizarCompraComponent_Template_app_factura_preview_confirmarCompra_2_listener($event) {\n              return ctx.confirmarCompra($event);\n            });\n            i0.…µ…µelementEnd();\n          }\n          if (rf & 2) {\n            i0.…µ…µadvance(2);\n            i0.…µ…µproperty(\"productos\", ctx.productosSeleccionados);\n          }\n        },\n        dependencies: [CommonModule, FacturaPreviewComponent],\n        styles: [\"h2[_ngcontent-%COMP%]{margin-bottom:20px}\"]\n      });\n    }\n  }\n  return FinalizarCompraComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}