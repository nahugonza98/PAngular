<div *ngIf="!isLoggedIn; else chatUI">
  <div class="chat-shell" id="loginCard">
    <h3>Iniciar sesión</h3>

    <form class="login" [formGroup]="loginForm" (ngSubmit)="login()">
      <label>Email</label>
      <input type="email" formControlName="email" placeholder="nombre@correo.com" />

      <label>Contraseña</label>
      <input type="password" formControlName="password" placeholder="••••••••" />

      <label>Nombre a mostrar en el chat</label>
      <input type="text" formControlName="username" placeholder="Tu alias" />

      <!-- Alerta genérica (no explícita) -->
      <div class="alert" *ngIf="loginErrorMsg">{{ loginErrorMsg }}</div>

      <button type="submit" [disabled]="loadingLogin || loginForm.invalid">
  {{ loadingLogin ? 'Ingresando…' : 'Iniciar sesión' }}
</button>
    </form>
  </div>
</div>

<ng-template #chatUI>
  <div class="chat-shell">
    <div class="chat-header">
      <div class="title">Sala global</div>
      <span class="spacer"></span>
      <button class="logout" (click)="logout()">Salir</button>
    </div>

    <div id="history" class="history">
      <div *ngFor="let chat of chats" class="msg" [ngClass]="{
          me: (chat.username || 'Anon') === (form.value.username || 'Anon'),
          other: (chat.username || 'Anon') !== (form.value.username || 'Anon')
        }">
        <div class="bubble">
          <div class="meta">
            <b>{{ chat.username || 'Anon' }}</b> <p></p>
            <span class="time">{{ chat.timestamp | date:'short' }}</span>
          </div>
          <div class="text">{{ chat.text }}</div>
        </div>
      </div>
    </div>

    <form id="message" class="composer" [formGroup]="form" (ngSubmit)="send()">
      <input type="text" formControlName="username" placeholder="Tu alias" />
      <div class="send-box">
        <input type="text" formControlName="message" placeholder="Escribe un mensaje…" autocomplete="off" />
        <button type="submit" [disabled]="form.invalid || !form.value.message?.trim()">Enviar</button>
      </div>
    </form>
  </div>
</ng-template>
