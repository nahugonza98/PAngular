<h2 class="titulo">Facturas generadas</h2>

<!-- Input de búsqueda -->
<div class="toolbar">
  <div class="buscador">
    <input
      type="text"
      [(ngModel)]="filtroFactura"
      placeholder="🔍 Buscar por ID..."
      class="form-control"
    />
  </div>

  <button class="btn btn-outline-success csv-btn" [routerLink]="['/estadisticas']">Estadísticas</button>
  <button type="button" class="csv-btn" (click)="exportarCSV()" [disabled]="descargandoCsv">
    Exportar CSV
  </button>
</div>

<!-- Tabla -->
<table class="tabla-facturas" *ngIf="facturas.length > 0; else sinDatos">
  <thead>
    <tr>
      <th>ID</th>
      <th>Fecha</th>
      <th>Total (ARS)</th>
      <th>Total (USD)</th>
      <th>Cliente</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let factura of facturas | filtroFactura:filtroFactura">
      <td>{{ factura.id }}</td>
      <td>{{ factura.fechaISO | date: 'short' }}</td>
      <td>$ {{ factura.totalARS | number: '1.2-2' }}</td>
      <td *ngIf="factura.totalUSD != null; else sinUSD">
        $ {{ factura.totalUSD | number: '1.2-2' }}
      </td>
      <ng-template #sinUSD><td>—</td></ng-template>
      <td>{{ factura.cliente_nombre || '—' }}</td>
    </tr>
  </tbody>
</table>

<ng-template #sinDatos>
  <p>No hay facturas registradas.</p>
</ng-template>
